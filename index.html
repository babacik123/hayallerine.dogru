<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxde5fgbtpRW7MDeLgMyyFK3qgGXILgRqi397ti4vd1V7HO3av5o3Kt_T7tYGNGHTcGqA/exec';

// Geri sayÄ±m
const examDate = new Date(2026, 8, 6, 9, 0, 0);
function updateCountdown() {
    const now = new Date().getTime();
    const distance = examDate - now;

    if (distance < 0) {
        document.getElementById('countdown').innerHTML = 
            '<h2>ðŸŽ‰ SÄ±nav TamamlandÄ±! Tebrikler! ðŸŽ‰</h2>';
        return;
    }

    const days = Math.floor(distance / (1000*60*60*24));
    const hours = Math.floor((distance % (1000*60*60*24)) / (1000*60*60));
    const minutes = Math.floor((distance % (1000*60*60)) / (1000*60));
    const seconds = Math.floor((distance % (1000*60)) / 1000);

    document.getElementById('days').textContent = days;
    document.getElementById('hours').textContent = hours;
    document.getElementById('minutes').textContent = minutes;
    document.getElementById('seconds').textContent = seconds;
}

// Not ekleme (POST)
async function addNote(user) {
    const textareaId = user === 'KÄ±z ArkadaÅŸÄ±' ? 'girlfriendNote' : 'boyfriendNote';
    const noteText = document.getElementById(textareaId).value.trim();

    if (!noteText) {
        alert('LÃ¼tfen bir not yazÄ±n!');
        return;
    }

    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ user: user, note: noteText })
        });
        const result = await response.json();

        if (result.success) {
            document.getElementById(textareaId).value = '';
            alert('Notunuz kaydedildi! ðŸŽ‰');
            loadAllNotes();
        } else {
            alert('Not kaydedilemedi.');
        }
    } catch (err) {
        alert('BaÄŸlantÄ± hatasÄ±! Not kaydedilemedi.');
        console.error(err);
    }
}

// NotlarÄ± Ã§ekme (GET)
async function loadAllNotes() {
    try {
        const response = await fetch(SCRIPT_URL);
        const notes = await response.json();

        document.getElementById('girlfriendNotes').innerHTML = '';
        document.getElementById('boyfriendNotes').innerHTML = '';

        notes.reverse().forEach(n => {
            const noteItem = document.createElement('div');
            noteItem.className = 'note-item ' + (n.user === 'KÄ±z ArkadaÅŸÄ±' ? 'girlfriend-note' : 'boyfriend-note');
            noteItem.innerHTML = `
                <div class="note-date">${new Date(n.timestamp).toLocaleString('tr-TR')}</div>
                <div class="note-user">${n.user}</div>
                <div class="note-text">${n.note}</div>
            `;
            if (n.user === 'KÄ±z ArkadaÅŸÄ±') document.getElementById('girlfriendNotes').prepend(noteItem);
            else document.getElementById('boyfriendNotes').prepend(noteItem);
        });
    } catch (err) {
        console.error('Notlar yÃ¼klenemedi:', err);
    }
}

// Sayfa yÃ¼klendiÄŸinde
document.addEventListener('DOMContentLoaded', () => {
    loadAllNotes();
    updateCountdown();
    setInterval(loadAllNotes, 30000); // 30 saniyede bir gÃ¼ncelle
    setInterval(updateCountdown, 1000);
});
</script>
